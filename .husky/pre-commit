# Skip hooks in CI environments
[ -n "$CI" ] && exit 0

echo "ğŸ” Running pre-commit qualification checks..."
echo ""

# 1. Lint-staged (format + lint staged files)
echo "ğŸ“ Linting and formatting staged files..."
pnpm lint-staged || {
    echo "âŒ Lint-staged failed. Errors auto-fixed where possible."
    echo "â„¹ï¸  Please review changes and re-add files with 'git add'"
    exit 1
}
echo "âœ… Lint-staged passed!"
echo ""

# 2. TypeScript
echo "ğŸ”· Type checking..."
pnpm typecheck || {
    echo "âŒ Type check failed. Please fix TypeScript errors."
    exit 1
}
echo "âœ… Type check passed!"
echo ""

# 3. Unit Tests (with coverage)
echo "ğŸ§ª Running unit tests with coverage..."
pnpm test:coverage -- --run || {
    echo "âŒ Tests failed. Please fix failing tests."
    exit 1
}
echo "âœ… All tests passed!"
echo ""

# 4. Electron compile (ensure electron code compiles)
echo "âš¡ Verifying Electron compilation..."
pnpm electron:compile || {
    echo "âŒ Electron compilation failed. Please fix errors."
    exit 1
}
echo "âœ… Electron compilation passed!"
echo ""

# 5. Build (ensure production build works)
echo "ğŸ—ï¸  Verifying production build..."
pnpm build || {
    echo "âŒ Production build failed. Please fix build errors."
    exit 1
}
echo "âœ… Production build passed!"
echo ""

# 6. E2E Tests (quick, only changed files)
echo "ğŸš€ Running E2E tests..."
pnpm test:e2e || {
    echo "âŒ E2E tests failed. Please fix E2E test errors."
    exit 1
}
echo "âœ… E2E tests passed!"
echo ""

echo "âœ… All pre-commit checks passed! Ready to commit!"
